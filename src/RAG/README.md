# RAG (Retrieval-Augmented Generation) 示例代码总结

本目录包含了从基础到高级的RAG实现示例，展示了不同的检索增强生成技术。

## 技术概览

- **r1_simple_rag.py**: 基础RAG实现，包含PDF文本提取、固定大小分块、向量化和语义搜索的完整流程
- **r2_semantic_chunking.py**: 基于句子相似度的智能分块，通过余弦相似度动态确定最佳分块边界
- **r3_chunk_size_selector.py**: 多尺寸分块对比，自动选择最优分块大小以提升检索性能
- **r4_contextual_enriched_rag.py**: 上下文增强检索，通过重叠分块保留语义连贯性
- **r5_contextual_chunk_headers.py**: 标题增强分块，为每个文本块生成语义标题以改善检索效果
- **r6_doc_augmentation_rag.py**: 文档增强技术，通过问题生成扩展检索语义空间
- **r7_query_transform.py**: 查询转换优化，实现查询重写、回退提示和子查询分解三种技术

## 示例代码总结

### r1_simple_rag.py - 基础RAG实现

这个示例展示了RAG系统的基础实现，包括：

- **PDF文本提取**：使用PyMuPDF (fitz) 从PDF文件中提取文本内容
- **文本分块**：将长文本按固定字符数（500字符）进行分块，设置重叠度（100字符）
- **向量化**：使用OpenAI的embedding模型将文本块转换为向量表示
- **语义搜索**：实现余弦相似度算法进行语义检索
- **问答生成**：基于检索到的相关文本块生成AI回答
- **质量评估**：使用评估系统对AI回答进行评分

**核心特点**：
- 使用火山引擎API作为OpenAI兼容服务
- 实现了完整的RAG流程：检索→增强→生成
- 包含基础的评估机制

### r2_semantic_chunking.py - 语义分块

这个示例展示了基于语义相似度的智能文本分块技术：

- **语义分块算法**：通过计算相邻句子的余弦相似度来确定最佳分块点
- **多种断点计算方法**：
  - 百分位法（percentile）
  - 标准差法（standard_deviation）
  - 四分位距法（interquartile）
- **动态分块**：根据文本的语义连贯性自动确定分块边界
- **相似度分析**：可视化句子间的相似度分布

**核心特点**：
- 避免了固定字符数分块可能切断语义完整性的问题
- 提供了多种阈值计算方法以适应不同文本类型
- 实现了更智能的文档预处理

### r3_chunk_size_selector.py - 分块大小选择器

这个示例展示了如何自动选择最优的文本分块大小：

- **多尺寸分块**：同时生成不同大小（128、256、512字符）的文本块
- **性能评估**：通过检索准确性和回答质量评估不同分块大小的效果
- **批量嵌入**：高效处理大量文本块的向量化
- **对比分析**：比较不同分块策略对RAG系统性能的影响

**核心特点**：
- 自动化分块大小优化
- 基于实际性能指标选择最佳参数
- 提供了分块策略选择的科学方法

### r4_contextual_enriched_rag.py - 上下文增强RAG

这个示例展示了如何通过上下文增强提高RAG系统的回答质量：

- **重叠上下文分块**：使用1000字符块大小，200字符重叠度
- **上下文感知检索**：检索相关块及其邻居以获得更好的完整性
- **增强的上下文**：在检索结果中包含相邻文本块以提供更完整的背景信息
- **改进的连贯性**：通过保留上下文信息提高回答的连贯性

**核心特点**：
- 解决了传统RAG返回孤立文本片段的问题
- 通过重叠分块保留上下文信息
- 提高了回答的完整性和准确性

### r5_contextual_chunk_headers.py - 带标题的上下文分块

这个示例展示了如何为文本块添加语义标题以提高检索效果：

- **自动标题生成**：使用LLM为每个文本块生成简洁且信息丰富的标题
- **标题增强检索**：将标题信息纳入检索过程
- **结构化分块**：每个文本块包含标题和内容两个部分
- **语义索引**：通过标题提供更好的语义索引

**核心特点**：
- 通过标题提供额外的语义信息
- 改善了检索的准确性和相关性
- 提供了更结构化的文档表示

### r6_doc_augmentation_rag.py - 文档增强RAG

这个示例展示了通过问题生成来增强RAG系统：

- **问题生成**：为每个文本块生成相关的问题（默认5个问题）
- **双重检索**：同时检索相关文本块和生成的问题
- **增强的检索空间**：通过问题扩展了检索的语义空间
- **问题-答案匹配**：通过生成的问题提高检索的针对性

**核心特点**：
- 通过问题生成扩展了文档的语义表示
- 提高了检索的覆盖面和准确性
- 实现了更智能的文档增强策略

### r7_query_transform.py - 查询转换

这个示例展示了三种查询转换技术来增强RAG系统的检索性能：

- **查询重写（Query Rewriting）**：使查询更加具体和详细，提高搜索精度
- **回退提示（Step-back Prompting）**：生成更广泛的查询以检索上下文背景信息
- **子查询分解（Sub-query Decomposition）**：将复杂查询拆分为更简单的组件

**核心特点**：
- 不依赖专用库，纯Python实现
- 提供了三种不同的查询优化策略
- 显著提高了检索信息的关联性和全面性
- 适用于复杂查询的处理

## 技术栈

- **PDF处理**：PyMuPDF (fitz)
- **向量化**：OpenAI Embedding API
- **语言模型**：OpenAI GPT API (兼容服务)
- **数值计算**：NumPy
- **进度显示**：tqdm
- **环境配置**：python-dotenv

## 使用说明

1. 确保安装了所需的依赖包
2. 配置环境变量（API密钥等）
3. 准备PDF文档和评估数据集
4. 运行相应的示例文件

## 评估指标

- **检索准确性**：基于余弦相似度的语义检索
- **回答质量**：通过评估系统对AI回答进行评分
- **系统性能**：不同分块大小和策略的对比分析

这些示例展示了RAG系统从基础实现到高级优化的完整演进过程，为构建高质量的检索增强生成系统提供了参考实现。
